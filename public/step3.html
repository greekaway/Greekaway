<!DOCTYPE html>
<html lang="el" class="booking-step2-root booking-step3-root">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Greekaway – Βήμα 3</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <!-- Unified footer: keep single injection via footer.js; prevent double load by adding id -->
  <link id="ga-footer-rounded-css" rel="stylesheet" href="/css/footer-rounded.css">
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="stylesheet" href="/css/step2.css">
  <link rel="stylesheet" href="/css/step3.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1B2A3A">
  <link rel="stylesheet" href="/pwa.css">
  <link rel="stylesheet" href="/css/pwa-fixes.css">
</head>
<body class="booking-step booking-step2 booking-step3">
  <main id="step3Root" class="step2-shell step3-shell" aria-live="polite">
    <header class="step2-head step3-head">
      <div class="step-head-top">
        <div class="step-chip" data-i18n="booking.step3_of3">Βήμα 3 από 3</div>
        <div id="s3PriceLine" class="price-line">—</div>
      </div>
      <h1 id="s3TripTitle">Φόρτωση εκδρομής…</h1>
      <div class="step2-meta">
        <span id="s3TripDate" class="meta-pill">—</span>
        <span id="s3ModeLabel" class="meta-pill" hidden>—</span>
      </div>
    </header>

    <div id="s3Error" class="step3-inline-error" hidden data-i18n="booking.traveler_profile_incomplete">Συμπλήρωσε το προφίλ ταξιδιώτη για να συνεχίσεις.</div>

    <section class="step2-panels s2-fields step3-panels" role="group" aria-label="Περίληψη κράτησης">
      <article class="step2-card step3-card" id="summaryTravelersCard">
        <div class="card-head">
          <p class="card-kicker">Επιβάτες</p>
          <h2>Επιβεβαίωση ταξιδιωτών</h2>
          <p class="card-sub">Δες ξανά όσους δήλωσες στο Βήμα 2.</p>
        </div>
        <div class="card-body step3-summary">
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.adults">Ενήλικες</div>
            <div class="s3-value" id="vAdults">—</div>
          </div>
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.children">Παιδιά</div>
            <div class="s3-value" id="vChildren">—</div>
          </div>
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.suitcases">Αποσκευές</div>
            <div class="s3-value" id="vBags">—</div>
          </div>
        </div>
      </article>

      <article class="step2-card step3-card" id="summaryPickupCard">
        <div class="card-head">
          <p class="card-kicker">Παραλαβή &amp; επικοινωνία</p>
          <h2>Σημείο &amp; γλώσσα</h2>
          <p class="card-sub">Το σύστημα μεταφέρει αυτόματα τις επιλογές σου.</p>
        </div>
        <div class="card-body step3-summary">
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.preferred_language">Γλώσσα επικοινωνίας</div>
            <div class="s3-value" id="vLang">—</div>
          </div>
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.pickup_location">Σημείο Παραλαβής</div>
            <div class="s3-value" id="vPickup">—</div>
          </div>
          <div class="s2-row s3-row" id="vNotesInfoRow" hidden>
            <div class="s3-label" data-i18n="booking.driver_message">Μήνυμα στον οδηγό</div>
            <div class="s3-value" id="vNotesInfo">—</div>
          </div>
        </div>
      </article>

      <article class="step2-card step3-card" id="summaryProfileCard">
        <div class="card-head">
          <p class="card-kicker">Προτιμήσεις</p>
          <h2>Προφίλ ταξιδιώτη</h2>
          <p class="card-sub">Καθρέφτης του προφίλ που όρισες.</p>
        </div>
        <div class="card-body step3-summary">
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.age_group">Ηλικιακή ομάδα</div>
            <div class="s3-value" id="vAgeGroup">—</div>
          </div>
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.traveler_type">Τύπος ταξιδιώτη</div>
            <div class="s3-value" id="vTravelerType">—</div>
          </div>
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.interests">Ενδιαφέροντα</div>
            <div class="s3-value" id="vInterest">—</div>
          </div>
          <div class="s2-row s3-row">
            <div class="s3-label" data-i18n="booking.sociality">Κοινωνικότητα</div>
            <div class="s3-value" id="vSocial">—</div>
          </div>
          <div class="s2-row s3-row emph">
            <div class="s3-label" data-i18n="booking.trip_cost">Κόστος εκδρομής</div>
            <div class="s3-value" id="vTripCost">—</div>
          </div>
        </div>
      </article>
    </section>

    <div class="cta-bar step2-cta step3-cta">
      <button id="s3Back" class="btn-secondary" data-i18n="booking.return_button">Επιστροφή</button>
      <button id="s3ProceedPay" class="btn-primary" data-i18n="booking.proceed_payment">Πληρωμή</button>
    </div>
  </main>

  <!-- Overlays: About, AI, Profile for consistent footer actions -->
  <div id="aboutOverlay" class="overlay" role="dialog" aria-modal="true" hidden>
    <button class="close-overlay" onclick="closeOverlay('aboutOverlay')" aria-label="Κλείσιμο">×</button>
    <div class="overlay-inner">
      <h2 data-i18n="about.title">Σχετικά με εμάς</h2>
      <p data-i18n="about.text">Το Greekaway δημιουργήθηκε για να σας προσφέρει επιλεγμένες εκδρομές στην Ελλάδα με άνεση, τεχνολογία και στυλ.</p>
    </div>
  </div>

  <div id="aiOverlay" class="overlay" role="dialog" aria-modal="true" hidden>
    <button class="close-overlay" onclick="closeOverlay('aiOverlay')" aria-label="Κλείσιμο">×</button>
    <div class="overlay-inner">
      <h2 data-i18n="nav.ai">Βοηθός AI</h2>
      <p data-i18n="welcome.ask">Ρωτήστε μας ό,τι θέλετε για την εκδρομή σας!</p>
    </div>
  </div>

  <!-- Footer will be injected from /partials/footer-inner.html by /js/footer.js -->
  <footer></footer>

  <!-- Load i18n first and add cache-busting -->
  <script src="/js/i18n.js?v=20251022" defer></script>
  <script src="/js/overlay-manager.js?v=2" defer></script>
  <script src="/js/assistant.js?v=2" defer></script>
  <!-- Shared booking state utilities -->
  <script src="/js/booking-state.js" defer></script>
  <script src="/pwa-install.js" defer></script>
  <script>
    try { document.body.classList.add('has-rounded-footer'); } catch(_){ }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // Safe i18n accessor: if translation not ready or equals key, return fallback
      function tSafe(key, fallback){
        try { const v = (window.t && window.t(key)) || ''; return (v && v !== key) ? v : fallback; } catch(_){ return fallback; }
      }

      const modeLabels = { bus: 'Ομαδικό λεωφορείο', van: 'Mini van', mercedes: 'Ιδιωτική μεταφορά' };
      function normalizeModeKey(mode){
        const normalized = String(mode || '').toLowerCase().trim();
        if (!normalized) return '';
        if (normalized === 'mercedes/private' || normalized === 'private' || normalized === 'vip') return 'mercedes';
        if (normalized === 'multi' || normalized === 'shared' || normalized === 'minivan') return 'van';
        return normalized;
      }
      function hydrateStep3HeaderMeta(){
        const dateEl = document.getElementById('s3TripDate');
        const modeEl = document.getElementById('s3ModeLabel');
        const dateVal = (sessionStorage.getItem('gw_trip_date') || '').trim();
        if (dateEl) dateEl.textContent = dateVal || '—';
        let modeKey = normalizeModeKey(sessionStorage.getItem('gw_trip_mode') || '');
        if (!modeKey && window.__loadedTrip && window.__loadedTrip.defaultMode) {
          modeKey = normalizeModeKey(window.__loadedTrip.defaultMode);
        }
        if (modeEl) {
          if (modeKey) {
            const friendly = modeLabels[modeKey] || modeKey.toUpperCase();
            modeEl.textContent = friendly;
            modeEl.hidden = false;
          } else {
            modeEl.hidden = true;
          }
        }
      }

      function pickModeBlock(trip, key){
        if (!trip || !trip.modes) return null;
        const normalized = normalizeModeKey(key);
        if (normalized && trip.modes[normalized]) return trip.modes[normalized];
        if (trip.defaultMode && trip.modes[trip.defaultMode]) return trip.modes[trip.defaultMode];
        const activeKey = Object.keys(trip.modes || {}).find((mode)=>trip.modes[mode] && trip.modes[mode].active);
        if (activeKey) return trip.modes[activeKey];
        const firstKey = Object.keys(trip.modes)[0];
        return firstKey ? trip.modes[firstKey] : null;
      }

      function computeModePrice(modeBlock, adultsCount){
        if (!modeBlock) return 0;
        const pricePerPerson = Number(modeBlock.price_per_person) || 0;
        const priceTotal = Number(modeBlock.price_total) || 0;
        if (pricePerPerson > 0) {
          return pricePerPerson * Math.max(1, adultsCount || 1);
        }
        if (priceTotal > 0) return priceTotal;
        return 0;
      }

      function getAdultsForPrice(){
        try {
          const stored = parseInt(sessionStorage.getItem('gw_adults') || '0', 10);
          if (Number.isFinite(stored) && stored > 0) return stored;
        } catch(_){ }
        return 1;
      }

      // Normalize URL params into sessionStorage so Step 3 can render even on direct opens
      try {
        const p = new URLSearchParams(window.location.search);
        const qId = (function(params){
          const tripVal = (params.get('trip') || '').trim();
          if (tripVal) return tripVal;
          const legacy = (params.get('id') || '').trim();
          if (!legacy) return '';
          try {
            params.set('trip', legacy);
            params.delete('id');
            const query = params.toString();
            const hash = window.location.hash || '';
            const next = query ? `${window.location.pathname}?${query}${hash}` : `${window.location.pathname}${hash}`;
            window.history.replaceState({}, '', next);
          } catch(_){ }
          return legacy;
        })(p);
        const qDate = (p.get('date') || '').trim();
        const qAdults = (p.get('adults') || p.get('seats') || '').trim();
        if (qId && !sessionStorage.getItem('gw_trip_id')) sessionStorage.setItem('gw_trip_id', qId);
        if (qDate && !sessionStorage.getItem('gw_trip_date')) sessionStorage.setItem('gw_trip_date', qDate);
        if (qAdults && !sessionStorage.getItem('gw_adults')) sessionStorage.setItem('gw_adults', String(parseInt(qAdults,10)||1));
      } catch(_){ }

      hydrateStep3HeaderMeta();
      try {
        const storedTitle = sessionStorage.getItem('gw_trip_title') || '';
        if (storedTitle) {
          const titleEl = document.getElementById('s3TripTitle');
          if (titleEl && (!titleEl.textContent || titleEl.textContent.includes('Φόρτωση'))) {
            titleEl.textContent = storedTitle;
          }
        }
      } catch(_){ }

      // Small helpers missing in original script
      function get(k, d=''){ try { const v=sessionStorage.getItem(k); return v==null?d:v; } catch(_){ return d; } }
      const langFallbackLabels = { el:'Ελληνικά', en:'English', fr:'Français', de:'Deutsch', it:'Italiano', es:'Español', ru:'Русский', he:'עברית', nl:'Nederlands', pt:'Português', sv:'Svenska', ko:'한국어', zh:'中文' };
      const langFlags = { el:'🇬🇷', en:'🇬🇧', fr:'🇫🇷', de:'🇩🇪', it:'🇮🇹', es:'🇪🇸', ru:'🇷🇺', he:'🇮🇱', nl:'🇳🇱', pt:'🇵🇹', sv:'🇸🇪', ko:'🇰🇷', zh:'🇨🇳' };
      // Step 3 is read-only: do NOT rebuild or mutate booking state here.

      function renderValuesFromState(){
        const state = (window.GWBookingState && window.GWBookingState.get && window.GWBookingState.get()) || null;
        try { console.log('[step3] GWBookingState.get()', state); } catch(_){ }
        const adults = (()=>{ try { return parseInt(sessionStorage.getItem('gw_adults')||'0',10)||0; } catch(_){ return 0; } })();
        const ages = (()=>{ try { return JSON.parse(sessionStorage.getItem('gw_children_ages')||'[]')||[]; } catch(_){ return []; } })();
        const children = String(ages.length);
        const bags = (state && state.suitcases) ? state.suitcases : { small:0, medium:0, large:0 };
        const totalBags = (bags.small||0)+(bags.medium||0)+(bags.large||0);
        const langC = (state && state.traveler_profile && state.traveler_profile.language) ? state.traveler_profile.language : (localStorage.getItem('gw_lang')||'el');
        const ageG = (state && state.traveler_profile && state.traveler_profile.age_group) || '';
        const travT = (state && state.traveler_profile && state.traveler_profile.type) || '';
        const interest = (function(){ try { return sessionStorage.getItem('gw_interest')||''; } catch(_){ return ''; } })() || (state && state.traveler_profile && state.traveler_profile.interest) || '';
        const social = (state && state.traveler_profile && state.traveler_profile.social) || '';

        document.getElementById('vAdults').textContent = String(adults || 0);
        document.getElementById('vChildren').textContent = ages.length ? (children + ' (' + ages.join('-') + ')') : '—';
        if (totalBags) {
          const parts = [];
          if (bags.small) parts.push(`${bags.small}S`);
          if (bags.medium) parts.push(`${bags.medium}M`);
          if (bags.large) parts.push(`${bags.large}L`);
          const detail = parts.join(' · ');
          document.getElementById('vBags').textContent = detail ? `${totalBags} (${detail})` : String(totalBags);
        } else {
          document.getElementById('vBags').textContent = '—';
        }
        const langLabel = tSafe('booking.preferred_language_options.' + langC, (langFallbackLabels[langC] || (langC && langC.toUpperCase()) || '—'));
        const langFlag = langFlags[langC] || '';
        document.getElementById('vLang').textContent = langLabel ? (langFlag ? `${langFlag} ${langLabel}` : langLabel) : '—';
        // Determine pickup address: simple preference order
        (function(){
          const val = (get('gw_pickup_address','') || (state && state.pickup && state.pickup.address) || '');
          document.getElementById('vPickup').textContent = (val || '—');
        })();
        document.getElementById('vAgeGroup').textContent = ageG || '—';
        const travTypeFallback = { explore:'Εξερευνητές – δραστήριοι', relax:'Χαλαροί ταξιδιώτες', family:'Οικογενειακό ύφος', solo:'Μοναχικοί ταξιδιώτες' };
        const interestFallback = { nature:'Φύση', culture:'Πολιτισμός', mountain:'Βουνό', sea:'Θάλασσα', gastronomy:'Γαστρονομία' };
        const travLabel = travT ? tSafe('booking.traveler_type_options.' + travT, (travTypeFallback[travT] || '—')) : '—';
        const intLabel = interest ? tSafe('booking.interests_options.' + interest, (interestFallback[interest] || '—')) : '—';
        const socLabel = social ? tSafe('booking.sociality_options.' + social, (social === 'social' ? 'Κοινωνικός' : social === 'quiet' ? 'Ήσυχος' : '—')) : '—';
        document.getElementById('vTravelerType').textContent = travLabel;
        document.getElementById('vInterest').textContent = intLabel;
        document.getElementById('vSocial').textContent = socLabel;
        // Special requests privacy-safe hint
        const row = document.getElementById('vNotesInfoRow');
        const el = document.getElementById('vNotesInfo');
        try {
          const notes = (state && state.special_requests) ? String(state.special_requests).trim() : (get('gw_notes','')||'').trim();
          if (notes && row && el) { el.textContent = tSafe('booking.driver_message_updated','✅ μήνυμα του οδηγού ενημερώθηκε'); row.hidden = false; }
          else if (row) { row.hidden = true; }
        } catch(_){ }
      }

      // Load trip JSON and update title + price
      async function loadTripAndUpdate(tripId){
        if (!tripId) return null;
        let dv = '';
        try {
          const rv = await fetch('/version.json', { cache: 'no-cache' });
          if (rv.ok) { const j = await rv.json(); dv = (j && j.dataVersion) ? ('?v=' + encodeURIComponent(String(j.dataVersion))) : ''; }
        } catch(_){ }
        try {
          const r = await fetch(`/data/trips/${encodeURIComponent(tripId)}.json${dv}`, { cache:'no-cache' });
          if (!r.ok) return null;
          const trip = await r.json();
          window.__loadedTrip = trip;
          try {
            const titleEl = document.getElementById('s3TripTitle');
            const lang = (window.currentI18n && window.currentI18n.lang) || localStorage.getItem('gw_lang') || 'el';
            const getLocalized = (field) => {
              if (!field) return '';
              if (typeof field === 'string') return field;
              if (typeof field === 'object') return field[lang] || field['el'] || Object.values(field)[0] || '';
              return '';
            };
            const title = getLocalized(trip.title);
            if (title && titleEl) titleEl.textContent = title;
          } catch(_){ }
          try {
            hydrateStep3HeaderMeta();
            renderTripCost();
          } catch(_){ }
          return trip;
        } catch(_){ return null; }
      }

      function resolvePriceLocale(){
        try {
          const lang = ((window.currentI18n && window.currentI18n.lang) || localStorage.getItem('gw_lang') || 'el').toLowerCase();
          const map = { en:'en-US', fr:'fr-FR', it:'it-IT', es:'es-ES', de:'de-DE' };
          return map[lang] || 'el-GR';
        } catch(_){ return 'el-GR'; }
      }

      function formatCurrency(amount, currency){
        if (!(amount >= 0)) return '—';
        try {
          return new Intl.NumberFormat(resolvePriceLocale(), { style:'currency', currency: currency || 'EUR' }).format(amount);
        } catch(_){
          return `${amount.toFixed(2)} ${currency || 'EUR'}`;
        }
      }

      function renderTripCost(){
        try {
          const state = (window.GWBookingState && window.GWBookingState.get && window.GWBookingState.get()) || null;
          let cents = (state && typeof state.price_cents === 'number' && state.price_cents > 0) ? state.price_cents : null;
          let cur = (state && state.currency) ? String(state.currency).toUpperCase() : 'EUR';
          if (cents == null) {
            try {
              const storedCents = parseInt(sessionStorage.getItem('gw_amount_cents') || '0', 10);
              if (storedCents > 0) {
                cents = storedCents;
                const storedCur = sessionStorage.getItem('gw_amount_currency');
                if (storedCur) cur = String(storedCur).toUpperCase();
              }
            } catch(_){ }
          }
          if (cents == null) {
            const trip = window.__loadedTrip || null;
            if (trip && trip.modes) {
              const modeKey = normalizeModeKey(sessionStorage.getItem('gw_trip_mode') || trip.defaultMode || '');
              const modeBlock = pickModeBlock(trip, modeKey);
              const adultsCount = getAdultsForPrice();
              const amount = computeModePrice(modeBlock, adultsCount);
              if (amount > 0) {
                cents = Math.round(amount * 100);
                cur = (trip.currency ? String(trip.currency).toUpperCase() : cur);
                try {
                  sessionStorage.setItem('gw_amount_cents', String(cents));
                  sessionStorage.setItem('gw_amount_currency', cur);
                } catch(_){ }
              }
            }
          }
          const priceLineEl = document.getElementById('s3PriceLine');
          const totalEl = document.getElementById('vTripCost');
          if (cents != null) {
            const amount = cents / 100;
            const val = formatCurrency(amount, cur);
            if (totalEl) totalEl.textContent = val;
            if (priceLineEl) priceLineEl.textContent = val;
          } else {
            if (totalEl) totalEl.textContent = '—';
            if (priceLineEl) priceLineEl.textContent = '—';
          }
        } catch(_){ }
      }

      // Ensure the "trip cost" label translates explicitly even if auto-scan misses it
      function translateTripCostLabel(){
        try {
          const el = document.querySelector('[data-i18n="booking.trip_cost"]');
          if (!el) return;
          const tx = (window.t && window.t('booking.trip_cost')) || '';
          if (tx && tx !== 'booking.trip_cost') el.textContent = tx;
        } catch(_){ }
      }

      // When UI language changes, re-render the trip title using loaded trip or fetch by id
      try {
        window.addEventListener('i18n:changed', async () => {
          try {
            const titleEl = document.getElementById('s3TripTitle');
            const lang = (window.currentI18n && window.currentI18n.lang) || localStorage.getItem('gw_lang') || 'el';
            const getLocalized = (field) => {
              if (!field) return '';
              if (typeof field === 'string') return field;
              if (typeof field === 'object') return field[lang] || field['el'] || Object.values(field)[0] || '';
              return '';
            };
            let trip = (window.__loadedTrip || null);
            let tripId = (sessionStorage.getItem('gw_trip_id') || '');
            if (!trip && tripId) {
              trip = await loadTripAndUpdate(tripId);
            }
            if (trip && titleEl) {
              const title = getLocalized(trip.title);
              if (title) titleEl.textContent = title;
            }
            try {
              renderTripCost();
              hydrateStep3HeaderMeta();
            } catch(_){ }
          } catch(_){ }
        });
      } catch(_){ }
      renderValuesFromState();
      try { renderTripCost(); } catch(_){ }
      try { translateTripCostLabel(); } catch(_){ }
      try { validateProfile(); } catch(_){ }

      document.getElementById('s3Back')?.addEventListener('click', ()=> history.back());

      function getTripMode(){
        try {
          const p = new URLSearchParams(window.location.search);
          return (p.get('mode') || localStorage.getItem('trip_mode') || 'van').toLowerCase();
        } catch(_) { return 'van'; }
      }
      function validateProfile(){
        const mode = getTripMode();
        const errBox = document.getElementById('s3Error');
        const ageRow = document.querySelector('#vAgeGroup')?.closest('.s3-row');
        const travRow = document.querySelector('#vTravelerType')?.closest('.s3-row');
        if (mode === 'bus') {
          // Bypass profile validation for bus mode; ensure no red states
          try { errBox?.setAttribute('hidden',''); ageRow?.classList.remove('required'); travRow?.classList.remove('required'); } catch(_){}
          return true;
        }
        const ageG = get('gw_age_group','').trim();
        const travT = get('gw_traveler_type','').trim();
        let ok = true;
        if (!ageG){ ok = false; ageRow?.classList.add('required'); } else { ageRow?.classList.remove('required'); }
        if (!travT){ ok = false; travRow?.classList.add('required'); } else { travRow?.classList.remove('required'); }
        if (!ok) { errBox?.removeAttribute('hidden'); }
        else { errBox?.setAttribute('hidden',''); }
        return ok;
      }

      document.getElementById('s3ProceedPay')?.addEventListener('click', (ev)=>{
        try { ev.preventDefault(); } catch(_){ }
        try { console.log('[step3] proceed to checkout'); } catch(_){ }
        const origin = (window.location && window.location.origin) || (window.location.protocol + '//' + window.location.host) || '';
        const url = origin ? (new URL('/checkout.html', origin).href) : '/checkout.html';
        try { window.location.assign(url); }
        catch(_e1){ try { window.location.href = url; } catch(_e2){ setTimeout(()=>{ window.location.href = '/checkout.html'; }, 0); } }
      });
      try { window.addEventListener('i18n:changed', () => { validateProfile(); }); } catch(_){ }

      // Ensure labels translate after i18n is ready and on future language changes
  try { if (window.currentI18n && window.setLanguage) { window.setLanguage(window.currentI18n.lang); translateTripCostLabel(); } } catch(_){ }
  try { setTimeout(()=>{ try { if (window.currentI18n && window.setLanguage) { window.setLanguage(window.currentI18n.lang); translateTripCostLabel(); } } catch(_){ } }, 60); } catch(_){ }
      try {
        window.addEventListener('i18n:changed', ()=>{ try { renderValuesFromState(); renderTripCost(); translateTripCostLabel(); } catch(_){ } });
      } catch(_){ }

      try {
        const tripId = sessionStorage.getItem('gw_trip_id') || '';
        if (tripId) loadTripAndUpdate(tripId);
      } catch(_){ }
    });
  </script>
  <script src="/js/feedback.js" defer></script>
  <script>try{ window.GWFeedbackPrompt && window.GWFeedbackPrompt.init && window.GWFeedbackPrompt.init(); }catch(e){}</script>
  <!-- Inject shared footer (Option A unification) -->
  <script src="/js/footer.js" defer></script>
  <script src="/js/main.js"></script>
</body>
</html>
