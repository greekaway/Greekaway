<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Greekaway Admin – Trips</title>
  <link rel="stylesheet" href="/css/admin-common.css">
  <link rel="stylesheet" href="/css/admin-tables.css">
  <link rel="stylesheet" href="/css/admin-theme-toggle.css">
  <link rel="stylesheet" href="/css/trips-admin.css">
  <link rel="manifest" href="/manifest-admin.json">
  <meta name="theme-color" content="#001f3f">
  <link rel="stylesheet" href="/pwa.css">
  <link rel="stylesheet" href="/css/pwa-fixes.css">
</head>
<body>
  <header class="sticky-bar" aria-label="Trips CMS" data-collapsed="false">
    <div class="bar-inner">
      <button id="togglePanel" class="filters-toggle" aria-label="Εμφάνιση/Απόκρυψη φόρμας" aria-expanded="true">▲</button>
      <form id="tripForm" class="trip-form" onsubmit="return false;">
        <div class="form-group">
          <label>Title *<input type="text" id="title" required></label>
          <label>Slug *<input type="text" id="slug" required></label>
          <label>Υπότιτλος (subtitle)<input type="text" id="subtitle" placeholder="π.χ. Premium εμπειρία"></label>
        </div>
        <div class="form-group">
          <label>Category *<select id="category" required></select></label>
        </div>
        <div class="form-group full-row file-row">
          <label class="file-input-wrapper">Trip Icon (SVG/PNG/WEBP)
            <input type="file" id="tripIcon" accept=".svg,.png,.webp" aria-label="Trip Icon">
          </label>
          <div class="icon-preview-wrap">
            <div id="tripIconPreview" class="category-icon admin-preview" aria-label="Trip icon preview"></div>
            <div class="hint small">Preview</div>
            <div id="tripIconName" class="filename small mono" aria-live="polite"></div>
          </div>
        </div>
        
        <label class="full">Tags (λέξεις-κλειδιά – μία ανά γραμμή)<textarea id="tagsInput" rows="3" placeholder="family\nfast-track"></textarea></label>

        <div class="form-group full-row file-row featured-image-row">
          <div class="featured-image-field">
            <label for="featuredImageInput">Κεντρική Φωτογραφία (Featured Image)</label>
            <p class="hint small">Εμφανίζεται επάνω από την εκδρομή. Χρησιμοποίησε εικόνα 1600px πλάτος.</p>
            <div class="featured-image-controls">
              <button type="button" class="btn secondary small" id="featuredImageTrigger">Επιλογή αρχείου</button>
              <button type="button" class="btn danger small" id="featuredImageClear" hidden>Αφαίρεση</button>
              <input type="file" id="featuredImageInput" accept="image/*" hidden aria-label="Κεντρική Φωτογραφία (Featured Image)">
            </div>
            <div id="featuredImageStatus" class="hint small" aria-live="polite"></div>
            <div id="featuredImageName" class="filename small mono" aria-live="polite"></div>
          </div>
          <div class="featured-image-preview-wrap">
            <img id="featuredImagePreview" alt="Προεπισκόπηση κεντρικής φωτογραφίας" hidden>
          </div>
        </div>
        <section aria-labelledby="modesTitle" class="modes-section">
          <h3 id="modesTitle" class="h1" style="margin-top:8px">Modes – Περιεχόμενο ανά όχημα</h3>
          <p class="hint" style="margin-bottom:12px">Κάθε mode έχει δικό του κείμενο, στάσεις, media και χάρτη. Συμπληρώστε τα πεδία για κάθε εμπειρία ξεχωριστά.</p>
          <div class="mode-stack">
            <article class="panel mode-card" data-mode-form="van">
              <div class="mode-header">
                <strong data-mode-label="van">Ορίστε τίτλο οχήματος</strong>
                <label class="mode-toggle"><input type="checkbox" data-field="active"> Active</label>
              </div>
              <div class="form-group stack-on-mobile">
                <label>Mode Title<input type="text" data-field="title" placeholder="π.χ. Deluxe Van Tour"></label>
                <label>Mode Subtitle<input type="text" data-field="subtitle" placeholder="Περιγραφή για hero"></label>
                <label>Duration (text)<input type="text" data-field="duration" placeholder="4 ώρες"></label>
                <label>Διάρκεια (ημέρες)<input type="number" min="0" step="1" data-field="duration_days"></label>
              </div>
              <label class="full">Mode Description<textarea data-field="description" rows="3" placeholder="Αναλυτική περιγραφή για το van mode"></textarea></label>
              <div class="form-group stack-on-mobile">
                <label>Τιμή ανά άτομο (€)<input type="number" min="0" step="0.01" data-field="price_per_person" placeholder="0.00"></label>
                <label>Τιμή ανά όχημα (€)<input type="number" min="0" step="0.01" data-field="price_total" placeholder="0.00"></label>
                <label>Τρόπος χρέωσης
                  <select data-field="charge_type">
                    <option value="per_person">per_person</option>
                    <option value="per_vehicle">per_vehicle</option>
                  </select>
                </label>
                <label>Capacity<input type="number" min="0" step="1" data-field="capacity" placeholder="7"></label>
              </div>
              <section class="panel form-panel">
                <h4>Περιλαμβάνεται / Δεν περιλαμβάνεται</h4>
                <div class="form-group stack-on-mobile">
                  <label>Περιλαμβάνονται<textarea rows="3" data-field="includes" placeholder="Premium οδηγός\nPrivate pickup"></textarea></label>
                  <label>Δεν περιλαμβάνονται<textarea rows="3" data-field="excludes" placeholder="Γεύματα\nΕισιτήρια"></textarea></label>
                </div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Στάσεις</h4>
                  <button type="button" class="btn secondary small" data-action="add-stop" data-mode="van">+ Προσθήκη στάσης</button>
                </div>
                <div class="repeatable-list" data-field="stopsList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Ενότητες Περιγραφής</h4>
                  <button type="button" class="btn secondary small" data-action="add-section" data-mode="van">+ Προσθήκη ενότητας</button>
                </div>
                <div class="repeatable-list" data-field="sectionsList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Συχνές Ερωτήσεις</h4>
                  <button type="button" class="btn secondary small" data-action="add-faq" data-mode="van">+ Προσθήκη ερώτησης</button>
                </div>
                <div class="repeatable-list" data-field="faqList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <h4>Media</h4>
                <div class="form-group stack-on-mobile">
                  <label>Gallery εικόνες<textarea rows="3" data-field="gallery" placeholder="https://greekaway.com/uploads/trips/van-1.jpg"></textarea></label>
                  <label>Videos (λίστα URL)<textarea rows="3" data-field="videos" placeholder="https://youtu.be/...\nhttps://cdn..."></textarea></label>
                </div>
                <div class="mode-media-tools" data-field="galleryTools">
                  <button type="button" class="btn secondary small" data-action="upload-mode-gallery" data-mode="van">Επιλογή αρχείων</button>
                  <input type="file" data-field="galleryUpload" data-mode="van" accept=".jpg,.jpeg,.png" multiple hidden>
                  <div class="mode-media-status" data-field="galleryStatus" aria-live="polite"></div>
                </div>
                <div class="form-group stack-on-mobile">
                  <label>Hero Video URL<input type="text" data-field="video_url" placeholder="https://www.youtube.com/embed/..."></label>
                  <label>Hero Thumbnail<input type="text" data-field="video_thumbnail" placeholder="https://greekaway.com/uploads/trips/video-thumb.jpg"></label>
                </div>
                <div class="mode-media-tools" data-field="heroThumbnailTools">
                  <button type="button" class="btn secondary small" data-action="upload-mode-hero-thumb" data-mode="van">Μεταφόρτωση thumbnail</button>
                  <button type="button" class="btn danger small" data-action="clear-mode-hero-thumb" data-mode="van">Καθαρισμός</button>
                  <input type="file" data-field="heroThumbnailUpload" data-mode="van" accept=".jpg,.jpeg,.png" hidden>
                  <div class="mode-media-status" data-field="heroThumbnailStatus" aria-live="polite"></div>
                </div>
              </section>
              <section class="panel form-panel">
                <h4>Χάρτης & Διαδρομή</h4>
                <p class="hint small">Πρώτη γραμμή = Έναρξη, τελευταία = Τερματισμός. Γράψε lat,lng,ετικέτα ανά γραμμή.</p>
                <label class="full">Route waypoints (lat,lng,label ανά γραμμή)
                  <textarea rows="3" data-field="map_waypoints" placeholder="37.9715,23.7257,Acropolis"></textarea>
                </label>
              </section>
            </article>

            <article class="panel mode-card" data-mode-form="mercedes">
              <div class="mode-header">
                <strong data-mode-label="mercedes">Ορίστε τίτλο οχήματος</strong>
                <label class="mode-toggle"><input type="checkbox" data-field="active"> Active</label>
              </div>
              <div class="form-group stack-on-mobile">
                <label>Mode Title<input type="text" data-field="title" placeholder="π.χ. Luxury Private Ride"></label>
                <label>Mode Subtitle<input type="text" data-field="subtitle"></label>
                <label>Duration (text)<input type="text" data-field="duration"></label>
                <label>Διάρκεια (ημέρες)<input type="number" min="0" step="1" data-field="duration_days"></label>
              </div>
              <label class="full">Mode Description<textarea data-field="description" rows="3"></textarea></label>
              <div class="form-group stack-on-mobile">
                <label>Τιμή ανά άτομο (€)<input type="number" min="0" step="0.01" data-field="price_per_person"></label>
                <label>Τιμή ανά όχημα (€)<input type="number" min="0" step="0.01" data-field="price_total"></label>
                <label>Τρόπος χρέωσης
                  <select data-field="charge_type">
                    <option value="per_person">per_person</option>
                    <option value="per_vehicle">per_vehicle</option>
                  </select>
                </label>
                <label>Capacity<input type="number" min="0" step="1" data-field="capacity" placeholder="1"></label>
              </div>
              <section class="panel form-panel">
                <h4>Περιλαμβάνεται / Δεν περιλαμβάνεται</h4>
                <div class="form-group stack-on-mobile">
                  <label>Περιλαμβάνονται<textarea rows="3" data-field="includes"></textarea></label>
                  <label>Δεν περιλαμβάνονται<textarea rows="3" data-field="excludes"></textarea></label>
                </div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Στάσεις</h4>
                  <button type="button" class="btn secondary small" data-action="add-stop" data-mode="mercedes">+ Προσθήκη στάσης</button>
                </div>
                <div class="repeatable-list" data-field="stopsList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Ενότητες Περιγραφής</h4>
                  <button type="button" class="btn secondary small" data-action="add-section" data-mode="mercedes">+ Προσθήκη ενότητας</button>
                </div>
                <div class="repeatable-list" data-field="sectionsList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Συχνές Ερωτήσεις</h4>
                  <button type="button" class="btn secondary small" data-action="add-faq" data-mode="mercedes">+ Προσθήκη ερώτησης</button>
                </div>
                <div class="repeatable-list" data-field="faqList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <h4>Media</h4>
                <div class="form-group stack-on-mobile">
                  <label>Gallery<textarea rows="3" data-field="gallery"></textarea></label>
                  <label>Videos<textarea rows="3" data-field="videos"></textarea></label>
                </div>
                <div class="mode-media-tools" data-field="galleryTools">
                  <button type="button" class="btn secondary small" data-action="upload-mode-gallery" data-mode="mercedes">Επιλογή αρχείων</button>
                  <input type="file" data-field="galleryUpload" data-mode="mercedes" accept=".jpg,.jpeg,.png" multiple hidden>
                  <div class="mode-media-status" data-field="galleryStatus" aria-live="polite"></div>
                </div>
                <div class="form-group stack-on-mobile">
                  <label>Hero Video URL<input type="text" data-field="video_url"></label>
                  <label>Hero Thumbnail<input type="text" data-field="video_thumbnail"></label>
                </div>
                <div class="mode-media-tools" data-field="heroThumbnailTools">
                  <button type="button" class="btn secondary small" data-action="upload-mode-hero-thumb" data-mode="mercedes">Μεταφόρτωση thumbnail</button>
                  <button type="button" class="btn danger small" data-action="clear-mode-hero-thumb" data-mode="mercedes">Καθαρισμός</button>
                  <input type="file" data-field="heroThumbnailUpload" data-mode="mercedes" accept=".jpg,.jpeg,.png" hidden>
                  <div class="mode-media-status" data-field="heroThumbnailStatus" aria-live="polite"></div>
                </div>
              </section>
              <section class="panel form-panel">
                <h4>Χάρτης & Διαδρομή</h4>
                <p class="hint small">Πρώτη γραμμή = Έναρξη, τελευταία = Τερματισμός. Γράψε lat,lng,ετικέτα ανά γραμμή.</p>
                <label class="full">Route waypoints<textarea rows="3" data-field="map_waypoints" placeholder="37.9715,23.7257,Acropolis"></textarea></label>
              </section>
            </article>

            <article class="panel mode-card" data-mode-form="bus">
              <div class="mode-header">
                <strong data-mode-label="bus">Ορίστε τίτλο οχήματος</strong>
                <label class="mode-toggle"><input type="checkbox" data-field="active"> Active</label>
              </div>
              <div class="form-group stack-on-mobile">
                <label>Mode Title<input type="text" data-field="title" placeholder="π.χ. Classic Group Tour"></label>
                <label>Mode Subtitle<input type="text" data-field="subtitle"></label>
                <label>Duration (text)<input type="text" data-field="duration"></label>
                <label>Διάρκεια (ημέρες)<input type="number" min="0" step="1" data-field="duration_days"></label>
              </div>
              <label class="full">Mode Description<textarea data-field="description" rows="3"></textarea></label>
              <div class="form-group stack-on-mobile">
                <label>Τιμή ανά άτομο (€)<input type="number" min="0" step="0.01" data-field="price_per_person"></label>
                <label>Τιμή ανά όχημα (€)<input type="number" min="0" step="0.01" data-field="price_total"></label>
                <label>Τρόπος χρέωσης
                  <select data-field="charge_type">
                    <option value="per_person">per_person</option>
                    <option value="per_vehicle">per_vehicle</option>
                  </select>
                </label>
                <label>Capacity<input type="number" min="0" step="1" data-field="capacity" placeholder="40"></label>
              </div>
              <section class="panel form-panel">
                <h4>Περιλαμβάνεται / Δεν περιλαμβάνεται</h4>
                <div class="form-group stack-on-mobile">
                  <label>Περιλαμβάνονται<textarea rows="3" data-field="includes"></textarea></label>
                  <label>Δεν περιλαμβάνονται<textarea rows="3" data-field="excludes"></textarea></label>
                </div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Στάσεις</h4>
                  <button type="button" class="btn secondary small" data-action="add-stop" data-mode="bus">+ Προσθήκη στάσης</button>
                </div>
                <div class="repeatable-list" data-field="stopsList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Ενότητες Περιγραφής</h4>
                  <button type="button" class="btn secondary small" data-action="add-section" data-mode="bus">+ Προσθήκη ενότητας</button>
                </div>
                <div class="repeatable-list" data-field="sectionsList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <div class="panel-header">
                  <h4>Συχνές Ερωτήσεις</h4>
                  <button type="button" class="btn secondary small" data-action="add-faq" data-mode="bus">+ Προσθήκη ερώτησης</button>
                </div>
                <div class="repeatable-list" data-field="faqList" aria-live="polite"></div>
              </section>
              <section class="panel form-panel">
                <h4>Media</h4>
                <div class="form-group stack-on-mobile">
                  <label>Gallery<textarea rows="3" data-field="gallery"></textarea></label>
                  <label>Videos<textarea rows="3" data-field="videos"></textarea></label>
                </div>
                <div class="mode-media-tools" data-field="galleryTools">
                  <button type="button" class="btn secondary small" data-action="upload-mode-gallery" data-mode="bus">Επιλογή αρχείων</button>
                  <input type="file" data-field="galleryUpload" data-mode="bus" accept=".jpg,.jpeg,.png" multiple hidden>
                  <div class="mode-media-status" data-field="galleryStatus" aria-live="polite"></div>
                </div>
                <div class="form-group stack-on-mobile">
                  <label>Hero Video URL<input type="text" data-field="video_url"></label>
                  <label>Hero Thumbnail<input type="text" data-field="video_thumbnail"></label>
                </div>
                <div class="mode-media-tools" data-field="heroThumbnailTools">
                  <button type="button" class="btn secondary small" data-action="upload-mode-hero-thumb" data-mode="bus">Μεταφόρτωση thumbnail</button>
                  <button type="button" class="btn danger small" data-action="clear-mode-hero-thumb" data-mode="bus">Καθαρισμός</button>
                  <input type="file" data-field="heroThumbnailUpload" data-mode="bus" accept=".jpg,.jpeg,.png" hidden>
                  <div class="mode-media-status" data-field="heroThumbnailStatus" aria-live="polite"></div>
                </div>
              </section>
              <section class="panel form-panel">
                <h4>Χάρτης & Διαδρομή</h4>
                <p class="hint small">Πρώτη γραμμή = Έναρξη, τελευταία = Τερματισμός. Γράψε lat,lng,ετικέτα ανά γραμμή.</p>
                <label class="full">Route waypoints<textarea rows="3" data-field="map_waypoints" placeholder="37.9715,23.7257,Acropolis"></textarea></label>
              </section>
            </article>
          </div>
        </section>
        <div class="actions">
          <button id="saveBtn" class="btn primary" type="button">Αποθήκευση / Ενημέρωση</button>
          <button id="resetBtn" class="btn secondary" type="button">Νέα εγγραφή</button>
          <button id="deleteBtn" class="btn danger" type="button" disabled>Διαγραφή</button>
        </div>
        <div id="formErrors" class="errors" aria-live="polite"></div>
        <div id="stopImageUploadAnnouncer" class="sr-only" aria-live="polite"></div>
        <div id="categoryWarning" class="warning" hidden>⚠ Η κατηγορία αυτής της εκδρομής δεν υπάρχει πλέον.</div>
      </form>
    </div>
  </header>

  <main class="content-wrap">
    <div class="table-wrap">
      <table id="tripsTable" class="table" aria-label="Λίστα Εκδρομών">
        <thead>
          <tr>
            <th>Title</th>
            <th>Slug</th>
            <th>Category</th>
            <th>Modes</th>
            <th>Icon</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="tripsMessage" class="hint" style="padding:8px;color:#666"></div>
    </div>
  </main>

  <div id="tripConfirmModal" class="modal" hidden>
    <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="tripConfirmTitle">
      <h3 id="tripConfirmTitle">Είσαι σίγουρος;</h3>
      <p>Η εκδρομή θα διαγραφεί οριστικά.</p>
      <div class="actions">
        <button id="tripConfirmCancel" class="btn secondary" type="button">Άκυρο</button>
        <button id="tripConfirmOk" class="btn danger" type="button">Διαγραφή</button>
      </div>
    </div>
  </div>

  <nav class="bottom-nav">
    <a href="/admin-home.html">Home</a>
    <a href="/admin-bookings.html">Bookings</a>
    <a href="/admin-payments.html">Payments</a>
    <a href="/admin-manual.html">Manual</a>
    <a href="/admin-providers.html">Providers</a>
    <a href="/admin-availability.html">Availability</a>
    <a href="/admin/trip-availability.html">Trip Availability</a>
    <a href="/admin-trips.html" class="active">Trips</a>
  </nav>
  <footer class="version">Greekaway Admin • v<span id="ga-version">—</span></footer>
  <script src="/js/admin-theme-toggle.js"></script>
  <script src="/admin/js/trip-template-loader.js"></script>
  <script src="/admin/trips.js"></script>
  <script src="/admin/js/trip-image-uploader.js"></script>
  <script src="/pwa-install.js" defer></script>
  <script src="/js/main.js"></script>
  <script>
    fetch('/version.json').then(r=>r.ok?r.json():null).then(v=>{ if(v){ document.getElementById('ga-version').textContent = v.version || '—' }});
    (function(){
      const header=document.querySelector('header.sticky-bar');
      const btn=document.getElementById('togglePanel');
      if(header&&btn){
        btn.addEventListener('click',()=>{
          const cur=header.getAttribute('data-collapsed')==='true';
          header.setAttribute('data-collapsed',cur? 'false':'true');
          btn.setAttribute('aria-expanded',cur? 'true':'false');
          btn.textContent = (cur? '▲':'▼');
        });
      }
    })();
  </script>
</body>
</html>
