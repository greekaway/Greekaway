<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Greekaway â€“ Î’Î®Î¼Î± 2</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="stylesheet" href="/css/step2.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#001f3f">
  <link rel="stylesheet" href="/pwa.css">
</head>
<body class="site-gradient">
  
  <div class="step2-header">
    <div class="trip-title" id="s2TripTitle">&nbsp;</div>
    <div class="trip-desc" id="s2TripDesc">&nbsp;</div>
  <div class="step-indicator" style="margin-top:14px;color:var(--color-gold,#d9b85f);font-weight:700;opacity:.9" data-i18n="booking.step2_of3">Î’Î®Î¼Î± 2 Î±Ï€ÏŒ 3</div>
  </div>

  <!-- Centered dark panel like Step 1 calendar host (empty for now) -->
  <div class="step2-band" aria-hidden="true">
    <div class="step2-card"></div>
  </div>

  <!-- Adults / Children counters -->
  <div class="s2-fields" role="group" data-i18n-aria="booking.traveler_options">
    <div class="s2-row">
      <div class="s2-labels">
        <div class="title" data-i18n="booking.adults">Î•Î½Î®Î»Î¹ÎºÎµÏ‚</div>
      </div>
      <div class="s2-counter">
        <button class="btn-round" id="adultsDec" data-i18n-aria="booking.decrease_adults">âˆ’</button>
        <div class="count" id="adultsCount">2</div>
        <button class="btn-round" id="adultsInc" data-i18n-aria="booking.increase_adults">+</button>
      </div>
    </div>
    <div class="s2-row">
      <div class="s2-labels">
        <div class="title" data-i18n="booking.children">Î Î±Î¹Î´Î¹Î¬</div>
        <div class="sub" data-i18n="booking.children_age_range">0 â€“ 17 ÎµÏ„ÏÎ½</div>
      </div>
      <div class="s2-ages" id="childrenAges"><span class="hint" data-i18n="booking.pick_ages">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î·Î»Î¹ÎºÎ¯ÎµÏ‚</span></div>
      <div class="s2-counter">
        <button class="btn-round" id="childrenDec" data-i18n-aria="booking.decrease_children">âˆ’</button>
        <div class="count" id="childrenCount">0</div>
        <button class="btn-round" id="childrenInc" data-i18n-aria="booking.increase_children">+</button>
      </div>
      <!-- Popover age picker -->
      <div class="age-picker" id="agePicker" hidden></div>
    </div>

    <!-- Suitcases (single field with popup) -->
    <div class="s2-row" id="suitcasesRow">
      <div class="s2-labels">
        <div class="title" data-i18n="booking.suitcases">Î‘Ï€Î¿ÏƒÎºÎµÏ…Î­Ï‚</div>
        <div class="sub" id="suitcaseSummary">â€”</div>
      </div>
      <div class="s2-counter">
        <button class="btn-round" id="suitcasesDec" aria-label="âˆ’">âˆ’</button>
        <div class="count" id="suitcasesCount">0</div>
        <button class="btn-round" id="suitcasesInc" aria-label="+">+</button>
      </div>
    </div>

    <!-- Pick-up Location reordered: title then map pin (left) then address input (right) -->
    <div class="s2-row pickup-required" id="pickupRow">
      <div class="s2-labels">
        <label for="pickupInput" id="pickupLabel" class="title" data-i18n="booking.pickup_location">Î£Î·Î¼ÎµÎ¯Î¿ Î Î±ÏÎ±Î»Î±Î²Î®Ï‚</label>
      </div>
      <div class="s2-input-group pickup-reordered">
        <button type="button" id="pickupMapBtn" class="s2-map-btn" title="Î§Î¬ÏÏ„Î·Ï‚" data-i18n-title="booking.map_btn_title" aria-label="Î§Î¬ÏÏ„Î·Ï‚">
          <i class="fa-solid fa-map-pin icon" aria-hidden="true"></i>
        </button>
        <input type="text" id="pickupInput" class="s2-input" data-i18n-placeholder="booking.pickup_placeholder" placeholder="Î‘ÏÏ‡Î¯ÏƒÏ„Îµ Î½Î± Ï€Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³ÎµÎ¯Ï„Îµ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·" autocomplete="off" />
      </div>
      <div class="places-dropdown" id="pickupSuggest" hidden></div>
    </div>

    <!-- Message to Driver (instead of Preferred language) -->
    <div class="s2-row" id="specialRequestsRow">
      <div class="s2-labels">
  <div class="title" data-i18n="booking.driver_message">ÎœÎ®Î½Ï…Î¼Î± ÏƒÏ„Î¿Î½ Î¿Î´Î·Î³ÏŒ</div>
      </div>
      <div class="s2-input-group">
  <textarea id="specialRequests" class="s2-textarea" rows="1" data-i18n-placeholder="booking.driver_message_placeholder" placeholder="ÎœÎ®Î½Ï…Î¼Î± Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ Î¿Î´Î·Î³ÏŒ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)"></textarea>
      </div>
    </div>

    

    <!-- Age Group -->
  <div class="s2-row" id="ageGroupRow">
      <div class="s2-labels">
        <div class="title" id="ageGroupTitle" data-i18n="booking.age_group">Î—Î»Î¹ÎºÎ¹Î±ÎºÎ® Î¿Î¼Î¬Î´Î±</div>
    <div class="field-inline-error" id="ageGroupError" hidden data-i18n="booking.choose_category">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</div>
      </div>
      <div class="s2-ages"></div>
      <div class="s2-right">
        <button type="button" class="lang-select" id="ageSelectBtn">
          <span class="flag placeholder">ğŸ‡¬ğŸ‡·</span>
          <span class="label" data-i18n="ui.choose">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ</span>
          <span class="caret">â–¾</span>
        </button>
      </div>
      <div class="lang-menu" id="ageMenu" hidden>
        <button type="button" data-code="20-30"><span>ğŸ‘¤</span><span>20â€“30</span></button>
        <button type="button" data-code="30-40"><span>ğŸ‘¤</span><span>30â€“40</span></button>
        <button type="button" data-code="40-55"><span>ğŸ‘¤</span><span>40â€“55</span></button>
        <button type="button" data-code="55+"><span>ğŸ‘¤</span><span>55+</span></button>
      </div>
    </div>

    <!-- Traveler Type -->
  <div class="s2-row" id="travTypeRow">
      <div class="s2-labels">
        <div class="title" id="travTypeTitle" data-i18n="booking.traveler_type">Î¤ÏÏ€Î¿Ï‚ Ï„Î±Î¾Î¹Î´Î¹ÏÏ„Î·</div>
    <div class="field-inline-error" id="travTypeError" hidden data-i18n="booking.choose_category">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</div>
      </div>
      <div class="s2-ages"></div>
      <div class="s2-right">
        <button type="button" class="lang-select" id="travTypeSelectBtn">
          <span class="flag placeholder">ğŸ·ï¸</span>
          <span class="label" data-i18n="ui.choose">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ</span>
          <span class="caret">â–¾</span>
        </button>
      </div>
      <div class="lang-menu" id="travTypeMenu" hidden>
        <button type="button" data-code="explore"><span>ğŸ§­</span><span data-i18n="booking.traveler_type_options.explore">Î•Î¾ÎµÏÎµÏ…Î½Î·Ï„Î­Ï‚ â€“ Î´ÏÎ±ÏƒÏ„Î®ÏÎ¹Î¿Î¹</span></button>
        <button type="button" data-code="relax"><span>ğŸ§˜</span><span data-i18n="booking.traveler_type_options.relax">Î§Î±Î»Î±ÏÎ¿Î¯ Ï„Î±Î¾Î¹Î´Î¹ÏÏ„ÎµÏ‚</span></button>
        <button type="button" data-code="family"><span>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span><span data-i18n="booking.traveler_type_options.family">ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÏŒ ÏÏ†Î¿Ï‚</span></button>
        <button type="button" data-code="solo"><span>ğŸ§</span><span data-i18n="booking.traveler_type_options.solo">ÎœÎ¿Î½Î±Ï‡Î¹ÎºÎ¿Î¯ Ï„Î±Î¾Î¹Î´Î¹ÏÏ„ÎµÏ‚</span></button>
      </div>
    </div>

    <!-- Interests -->
  <div class="s2-row" id="interestsRow">
      <div class="s2-labels">
        <div class="title" data-i18n="booking.interests">Î•Î½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î±</div>
      </div>
      <div class="s2-ages"></div>
      <div class="s2-right">
        <button type="button" class="lang-select" id="interestSelectBtn">
          <span class="flag placeholder">ğŸ·ï¸</span>
          <span class="label" data-i18n="ui.choose">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ</span>
          <span class="caret">â–¾</span>
        </button>
      </div>
      <div class="lang-menu" id="interestMenu" hidden>
        <button type="button" data-code="nature"><span>ğŸŒ¿</span><span data-i18n="booking.interests_options.nature">Î¦ÏÏƒÎ·</span></button>
        <button type="button" data-code="culture"><span>ğŸ›ï¸</span><span data-i18n="booking.interests_options.culture">Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚</span></button>
        <button type="button" data-code="mountain"><span>â›°ï¸</span><span data-i18n="booking.interests_options.mountain">Î’Î¿Ï…Î½ÏŒ</span></button>
        <button type="button" data-code="sea"><span>ğŸŒŠ</span><span data-i18n="booking.interests_options.sea">Î˜Î¬Î»Î±ÏƒÏƒÎ±</span></button>
        <button type="button" data-code="gastronomy"><span>ğŸ½ï¸</span><span data-i18n="booking.interests_options.gastronomy">Î“Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¯Î±</span></button>
      </div>
    </div>

    <!-- Sociality -->
  <div class="s2-row" id="socialityRow">
      <div class="s2-labels">
        <div class="title" data-i18n="booking.sociality">ÎšÎ¿Î¹Î½Ï‰Î½Î¹ÎºÏŒÏ„Î·Ï„Î±</div>
      </div>
      <div class="s2-ages"></div>
      <div class="s2-right">
        <button type="button" class="lang-select" id="socialSelectBtn">
          <span class="flag placeholder">ğŸ·ï¸</span>
          <span class="label" data-i18n="ui.choose">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ</span>
          <span class="caret">â–¾</span>
        </button>
      </div>
      <div class="lang-menu" id="socialMenu" hidden>
        <button type="button" data-code="social"><span>ğŸ˜Š</span><span data-i18n="booking.sociality_options.social">ÎšÎ¿Î¹Î½Ï‰Î½Î¹ÎºÏŒÏ‚</span></button>
        <button type="button" data-code="quiet"><span>ğŸ¤«</span><span data-i18n="booking.sociality_options.quiet">Î‰ÏƒÏ…Ï‡Î¿Ï‚</span></button>
      </div>
    </div>
  </div>

  <!-- Bottom actions like Step 1 -->
  <div class="s2-actions">
    <button id="s2Back" class="btn" data-i18n="ui.back">Î Î¯ÏƒÏ‰</button>
  <button id="s2Next" class="btn" data-i18n="booking.next">Î•Ï€ÏŒÎ¼ÎµÎ½Î¿</button>
  </div>

  <!-- Overlays: About, AI Assistant, Profile -->
  <div id="aboutOverlay" class="overlay" role="dialog" aria-modal="true" hidden>
    <button class="close-overlay" onclick="closeOverlay('aboutOverlay')" data-i18n-aria="ui.close">Ã—</button>
    <div class="overlay-inner">
      <h2 data-i18n="about.title">Î£Ï‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ ÎµÎ¼Î¬Ï‚</h2>
      <p data-i18n="about.text">Î¤Î¿ Greekaway Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î³Î¹Î± Î½Î± ÏƒÎ±Ï‚ Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÎµÎºÎ´ÏÎ¿Î¼Î­Ï‚ ÏƒÏ„Î·Î½ Î•Î»Î»Î¬Î´Î± Î¼Îµ Î¬Î½ÎµÏƒÎ·, Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯Î± ÎºÎ±Î¹ ÏƒÏ„Ï…Î».</p>
    </div>
  </div>

  <div id="aiOverlay" class="overlay" role="dialog" aria-modal="true" hidden>
    <button class="close-overlay" onclick="closeOverlay('aiOverlay')" data-i18n-aria="ui.close">Ã—</button>
    <div class="overlay-inner">
      <h2 data-i18n="nav.ai">Î’Î¿Î·Î¸ÏŒÏ‚ AI</h2>
      <p data-i18n="welcome.ask">Î¡Ï‰Ï„Î®ÏƒÏ„Îµ Î¼Î±Ï‚ ÏŒ,Ï„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÎ´ÏÎ¿Î¼Î® ÏƒÎ±Ï‚!</p>
    </div>
  </div>

  <div id="profileOverlay" class="overlay" role="dialog" aria-modal="true" hidden>
    <button class="close-overlay" onclick="closeOverlay('profileOverlay')" data-i18n-aria="ui.close">Ã—</button>
    <div class="overlay-inner">
      <h2 data-i18n="nav.profile">Î¤Î¿ Î ÏÎ¿Ï†Î¯Î» Î¼Î¿Ï…</h2>
      <p data-i18n="profile.info">Î•Î´Ï Î¸Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ ÎµÎºÎ´ÏÎ¿Î¼Î­Ï‚ Ï€Î¿Ï… Î­Ï‡ÎµÏ„Îµ ÎºÎ¬Î½ÎµÎ¹ ÎºÎ±Î¹ Ï„Î¹Ï‚ ÎºÏÎ±Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÎ±Ï‚.</p>
    </div>
  </div>

  <!-- Shared footer -->
  <footer>
    <a href="/index.html">
      <i class="fas fa-home"></i>
      <span data-i18n="nav.home">Home</span>
    </a>

    <a href="javascript:void(0)" onclick="openOverlay('aboutOverlay')">
      <i class="fas fa-info-circle"></i>
      <span data-i18n="nav.about">About Us</span>
    </a>

    <a href="javascript:void(0)" class="central-btn">
      <i class="fas fa-bell"></i>
      <span data-i18n="nav.book">ÎšÏÎ¬Ï„Î·ÏƒÎ·</span>
    </a>

    <a href="javascript:void(0)" onclick="openOverlay('aiOverlay')">
      <i class="fas fa-comments"></i>
      <span data-i18n="nav.ai">AI Assistant</span>
    </a>

    <a href="javascript:void(0)" onclick="openOverlay('profileOverlay')">
      <i class="fas fa-user"></i>
      <span data-i18n="nav.profile">Î ÏÎ¿Ï†Î¯Î»</span>
    </a>
  </footer>
  <!-- Optional: overlays can be added later if needed -->
  <!-- Modals / Popups -->
  <div id="suitcasePopup" class="suitcase-popup" role="dialog" aria-modal="true" hidden>
    <div class="suitcase-dialog">
      <div class="suitcase-title" data-i18n="booking.suitcases">Î‘Ï€Î¿ÏƒÎºÎµÏ…Î­Ï‚</div>
      <div class="suitcase-options">
        <div class="suitcase-item" data-type="small">
          <div class="si-label" data-i18n="booking.suitcase_small">Small â€“ Hand luggage (55 cm â‰ˆ 10 kg)</div>
          <div class="si-ctrls">
            <button class="btn-round si-dec">âˆ’</button>
            <div class="count si-count">0</div>
            <button class="btn-round si-inc">+</button>
          </div>
        </div>
        <div class="suitcase-item" data-type="medium">
          <div class="si-label" data-i18n="booking.suitcase_medium">Medium â€“ 20 kg Suitcase (65 cm)</div>
          <div class="si-ctrls">
            <button class="btn-round si-dec">âˆ’</button>
            <div class="count si-count">0</div>
            <button class="btn-round si-inc">+</button>
          </div>
        </div>
        <div class="suitcase-item" data-type="large">
          <div class="si-label" data-i18n="booking.suitcase_large">Large â€“ 40 kg Suitcase (80 cm)</div>
          <div class="si-ctrls">
            <button class="btn-round si-dec">âˆ’</button>
            <div class="count si-count">0</div>
            <button class="btn-round si-inc">+</button>
          </div>
        </div>
      </div>
      <div class="suitcase-actions">
        <button type="button" class="btn" id="suitcaseConfirm" data-i18n="booking.confirm">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·</button>
        <button type="button" class="btn btn-secondary" id="suitcaseCancel" data-i18n="ui.cancel">Î†ÎºÏ…ÏÎ¿</button>
      </div>
    </div>
  </div>

  <div id="pickupMapModal" class="map-modal" role="dialog" aria-modal="true" hidden>
    <div class="map-dialog">
      <div class="map-title" data-i18n="booking.pickup_map_preview">Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Ï‡Î¬ÏÏ„Î·</div>
      <div id="pickupMap" class="map-area"></div>
      <div class="map-actions">
        <button type="button" class="btn" id="mapConfirm" data-i18n="booking.confirm">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·</button>
        <button type="button" class="btn btn-secondary" id="mapChange" data-i18n="booking.change">Î‘Î»Î»Î±Î³Î®</button>
      </div>
    </div>
  </div>

  <!-- Load i18n first so translations are ready before other logic; add cache-busting -->
  <script src="/js/i18n.js?v=20251022" defer></script>
  <script src="/js/overlay-manager.js?v=2" defer></script>
  <script src="/js/assistant.js?v=2" defer></script>
  <!-- Step 2 addons: suitcases popup, pickup autocomplete, special requests, validation -->
  <script src="/js/booking-addons.js?v=1" defer></script>
  <script>
    // Optional: lightweight behaviour â€” Î Î¯ÏƒÏ‰ Î³Ï…ÏÎ¯Î¶ÎµÎ¹ ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÏƒÎµÎ»Î¯Î´Î±
    try { document.getElementById('s2Back').addEventListener('click', () => history.back()); } catch(_){ }
    // Populate header from sessionStorage (set in Step 1)
    (function() {
      const headerEl = document.querySelector('.step2-header');
      const titleEl = document.getElementById('s2TripTitle');
      const descEl = document.getElementById('s2TripDesc');
      try {
        const t = sessionStorage.getItem('gw_trip_title') || '';
        const d = sessionStorage.getItem('gw_trip_desc') || '';
        const id = sessionStorage.getItem('gw_trip_id') || '';
        if (t) {
          titleEl.textContent = t;
        } else if (id) {
          // fetch trip json and localize based on current UI lang (or stored gw_lang)
          (async function(){
            try {
              const lang = (localStorage.getItem('gw_lang') || 'el');
              // get data version
              let dv = '';
              try { const rv = await fetch('/version.json', { cache: 'no-cache' }); if (rv.ok) { const j = await rv.json(); dv = j && j.dataVersion ? ('?v='+encodeURIComponent(String(j.dataVersion))) : ''; } } catch(_){ }
              const r = await fetch(`/data/trips/${encodeURIComponent(id)}.json${dv}`, { cache: 'no-cache' });
              if (!r.ok) return;
              const trip = await r.json();
              const getLocalized = (field) => {
                if (!field) return '';
                if (typeof field === 'string') return field;
                if (typeof field === 'object') return field[lang] || field['el'] || Object.values(field)[0] || '';
                return '';
              };
              const title = getLocalized(trip.title);
              const desc = getLocalized(trip.description);
              // cache loaded trip so i18n:changed can re-render it
              try { window.__loadedTrip = trip; } catch(_){ }
              if (title) titleEl.textContent = title;
              if (desc) descEl.textContent = desc;
            } catch(_){ }
          })();
        }
        if (!t && !d && !id && headerEl) headerEl.style.display = 'none';
      } catch(_) {
        if (headerEl) headerEl.style.display = 'none';
      }
    })();

    // Force-apply translations to all nodes inside Step 2 area
    function applyTranslationsToStep2() {
      try {
        if (!window.t) return;
        // narrow scope to the step2 container to avoid global reflow
        const root = document.body;
        const selAll = root.querySelectorAll('[data-i18n], [data-i18n-placeholder], [data-i18n-title], [data-i18n-aria], [data-i18n-value]');
        selAll.forEach(el => {
          try {
            if (el.hasAttribute('data-i18n')) {
              const key = el.getAttribute('data-i18n');
              const val = window.t(key);
              if (val && val !== key) el.textContent = val;
            }
            if (el.hasAttribute('data-i18n-placeholder')) {
              const key = el.getAttribute('data-i18n-placeholder');
              const val = window.t(key);
              if (val && val !== key) el.setAttribute('placeholder', val);
            }
            if (el.hasAttribute('data-i18n-title')) {
              const key = el.getAttribute('data-i18n-title');
              const val = window.t(key);
              if (val && val !== key) el.setAttribute('title', val);
            }
            if (el.hasAttribute('data-i18n-aria')) {
              const key = el.getAttribute('data-i18n-aria');
              const val = window.t(key);
              if (val && val !== key) el.setAttribute('aria-label', val);
            }
            if (el.hasAttribute('data-i18n-value')) {
              const key = el.getAttribute('data-i18n-value');
              const val = window.t(key);
              if (val && val !== key) el.value = val;
            }
          } catch(_){}
        });
      } catch(_){}
    }

    // Simple counters logic (limits: adults 1..10, children 0..10)
    (function(){
        // Safe i18n accessor to avoid rendering raw keys before i18n is ready
        function tSafe(key, fallback){
          try { const v = (window.t && window.t(key)) || ''; return (v && v !== key) ? v : fallback; } catch(_){ return fallback; }
        }
      const adultsCount = document.getElementById('adultsCount');
      const childrenCount = document.getElementById('childrenCount');
      const childrenAgesEl = document.getElementById('childrenAges');
      const agePicker = document.getElementById('agePicker');
      const ages = [];
      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
      const getN = (el) => parseInt((el && el.textContent) || '0', 10) || 0;
      const setN = (el, n) => { if (el) el.textContent = String(n); };
      const renderAges = () => {
        if (!childrenAgesEl) return;
        if (ages.length === 0) {
          // Show translatable hint; fallback if t() not ready
          const hint = (window.t ? window.t('booking.pick_ages') : 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î·Î»Î¹ÎºÎ¯ÎµÏ‚');
          childrenAgesEl.innerHTML = '<span class="hint" data-i18n="booking.pick_ages"></span>';
          // Also set immediate text for UX
          const span = childrenAgesEl.querySelector('.hint');
          if (span) span.textContent = hint;
        } else {
          childrenAgesEl.textContent = ages.join(', ');
        }
      };
      const openPicker = () => {
        if (!agePicker) return;
        if (ages.length >= 10) return; // respect max children
        if (agePicker.childElementCount === 0) {
          for (let i=1; i<=17; i++) {
            const b = document.createElement('button');
            b.type = 'button'; b.textContent = String(i);
            b.addEventListener('click', ()=>{
              if (ages.length < 10) {
                ages.push(i);
                setN(childrenCount, ages.length);
                renderAges();
              }
              closePicker();
            });
            agePicker.appendChild(b);
          }
        }
        agePicker.hidden = false;
        // decide drop direction
        const row = agePicker.closest('.s2-row');
        if (row) {
          const rect = row.getBoundingClientRect();
          const spaceBelow = window.innerHeight - rect.bottom;
          agePicker.classList.toggle('dropup', spaceBelow < 260);
        }
        setTimeout(()=>{
          const onDoc = (ev) => {
            if (!agePicker.contains(ev.target)) { closePicker(); document.removeEventListener('click', onDoc); }
          };
          document.addEventListener('click', onDoc);
        },0);
      };
      const closePicker = () => { if (agePicker) agePicker.hidden = true; };

  document.getElementById('adultsDec')?.addEventListener('click', ()=>{ const n=clamp(getN(adultsCount)-1,1,10); setN(adultsCount,n); });
  document.getElementById('adultsInc')?.addEventListener('click', ()=>{ const n=clamp(getN(adultsCount)+1,1,10); setN(adultsCount,n); });
      document.getElementById('childrenDec')?.addEventListener('click', ()=>{
        if (ages.length > 0) { ages.pop(); setN(childrenCount, ages.length); renderAges(); }
        else { const n=clamp(getN(childrenCount)-1,0,10); setN(childrenCount,n); }
      });
      document.getElementById('childrenInc')?.addEventListener('click', (e)=>{
        e.stopPropagation();
        openPicker();
      });
      renderAges();

      // Suitcases field: handled in booking-addons.js

      // Age group selector
      const ageBtn = document.getElementById('ageSelectBtn');
      const ageMenu = document.getElementById('ageMenu');
      const setAgeGroup = (code, label) => {
        const lblEl = ageBtn?.querySelector('.label');
        lblEl?.replaceChildren(document.createTextNode(label));
        // Prevent i18n auto-apply from reverting to "Choose"
        lblEl?.removeAttribute('data-i18n');
        try { sessionStorage.setItem('gw_age_group', code); } catch(_){ }
      };
  const ageMap = { '20-30':'20â€“30', '30-40':'30â€“40', '40-55':'40â€“55', '55+':'55+' };
      const defaultAge = (()=>{ try { return sessionStorage.getItem('gw_age_group') || ''; } catch(_){ return ''; } })();
      if (defaultAge && ageMap[defaultAge]) setAgeGroup(defaultAge, ageMap[defaultAge]);
  ageBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); if (ageMenu) { ageMenu.hidden = !ageMenu.hidden; if (!ageMenu.hidden) { const row = ageMenu.closest('.s2-row'); if (row) { const rect = row.getBoundingClientRect(); const spaceBelow = window.innerHeight - rect.bottom; ageMenu.classList.toggle('dropup', spaceBelow < 220); } } try { applyTranslationsToStep2(); } catch(_){} } });
      ageMenu?.querySelectorAll('button')?.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const code = btn.getAttribute('data-code') || '';
          const label = ageMap[code] || 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ';
          setAgeGroup(code, label);
          if (ageMenu) ageMenu.hidden = true;
          // Clear inline error and red border if any
          try {
            document.getElementById('ageGroupTitle')?.classList.remove('required');
            document.getElementById('ageGroupError')?.setAttribute('hidden','');
            document.getElementById('ageSelectBtn')?.classList.remove('error');
          } catch(_){ }
          // Notify shared logic to update Next button visual state
          try { document.dispatchEvent(new CustomEvent('gw:step2:fieldsChanged')); } catch(_){ }
        });
      });
      document.addEventListener('click', (e)=>{
        if (ageMenu && !ageMenu.hidden && !ageMenu.contains(e.target) && e.target !== ageBtn) ageMenu.hidden = true;
      });

      // Traveler type selector
      const travTypeBtn = document.getElementById('travTypeSelectBtn');
      const travTypeMenu = document.getElementById('travTypeMenu');
      const travTypeFallback = {
        explore: 'Î•Î¾ÎµÏÎµÏ…Î½Î·Ï„Î­Ï‚ â€“ Î´ÏÎ±ÏƒÏ„Î®ÏÎ¹Î¿Î¹',
        relax: 'Î§Î±Î»Î±ÏÎ¿Î¯ Ï„Î±Î¾Î¹Î´Î¹ÏÏ„ÎµÏ‚',
        family: 'ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÏŒ ÏÏ†Î¿Ï‚',
        solo: 'ÎœÎ¿Î½Î±Ï‡Î¹ÎºÎ¿Î¯ Ï„Î±Î¾Î¹Î´Î¹ÏÏ„ÎµÏ‚'
      };
      const setTravType = (code) => {
        const label = (code ? (window.t ? window.t('booking.traveler_type_options.' + code) : (travTypeFallback[code] || 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ')) : 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ');
        const lblEl = travTypeBtn?.querySelector('.label');
        lblEl?.replaceChildren(document.createTextNode(label));
        lblEl?.removeAttribute('data-i18n');
        try { sessionStorage.setItem('gw_traveler_type', code); } catch(_){ }
      };
      const defaultTravType = (()=>{ try { return sessionStorage.getItem('gw_traveler_type') || ''; } catch(_){ return ''; } })();
      if (defaultTravType) setTravType(defaultTravType);
  travTypeBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); if (travTypeMenu) { travTypeMenu.hidden = !travTypeMenu.hidden; if (!travTypeMenu.hidden) { const row = travTypeMenu.closest('.s2-row'); if (row) { const rect = row.getBoundingClientRect(); const spaceBelow = window.innerHeight - rect.bottom; travTypeMenu.classList.toggle('dropup', spaceBelow < 220); } } try { applyTranslationsToStep2(); } catch(_){} } });
      travTypeMenu?.querySelectorAll('button')?.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const code = btn.getAttribute('data-code') || '';
          setTravType(code);
          if (travTypeMenu) travTypeMenu.hidden = true;
          // Clear inline error and red border if any
          try {
            document.getElementById('travTypeTitle')?.classList.remove('required');
            document.getElementById('travTypeError')?.setAttribute('hidden','');
            document.getElementById('travTypeSelectBtn')?.classList.remove('error');
          } catch(_){ }
          // Notify shared logic to update Next button visual state
          try { document.dispatchEvent(new CustomEvent('gw:step2:fieldsChanged')); } catch(_){ }
        });
      });
      document.addEventListener('click', (e)=>{
        if (travTypeMenu && !travTypeMenu.hidden && !travTypeMenu.contains(e.target) && e.target !== travTypeBtn) travTypeMenu.hidden = true;
      });

      // Interests selector
      const interestBtn = document.getElementById('interestSelectBtn');
      const interestMenu = document.getElementById('interestMenu');
      const interestFallback = {
        nature: 'Î¦ÏÏƒÎ·',
        culture: 'Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚',
        mountain: 'Î’Î¿Ï…Î½ÏŒ',
        sea: 'Î˜Î¬Î»Î±ÏƒÏƒÎ±',
        gastronomy: 'Î“Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¯Î±'
      };
      const setInterest = (code) => {
        const label = (code ? (window.t ? window.t('booking.interests_options.' + code) : (interestFallback[code] || 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ')) : 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ');
        const lblEl = interestBtn?.querySelector('.label');
        lblEl?.replaceChildren(document.createTextNode(label));
        lblEl?.removeAttribute('data-i18n');
        try { sessionStorage.setItem('gw_interest', code); } catch(_){ }
      };
      const defaultInterest = (()=>{ try { return sessionStorage.getItem('gw_interest') || ''; } catch(_){ return ''; } })();
      if (defaultInterest) setInterest(defaultInterest);
  interestBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); if (interestMenu) { interestMenu.hidden = !interestMenu.hidden; if (!interestMenu.hidden) { const row = interestMenu.closest('.s2-row'); if (row) { const rect = row.getBoundingClientRect(); const spaceBelow = window.innerHeight - rect.bottom; interestMenu.classList.toggle('dropup', spaceBelow < 220); } } try { applyTranslationsToStep2(); } catch(_){} } });
      interestMenu?.querySelectorAll('button')?.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const code = btn.getAttribute('data-code') || '';
          setInterest(code);
          if (interestMenu) interestMenu.hidden = true;
        });
      });
      document.addEventListener('click', (e)=>{
        if (interestMenu && !interestMenu.hidden && !interestMenu.contains(e.target) && e.target !== interestBtn) interestMenu.hidden = true;
      });

      // Sociality selector
      const socialBtn = document.getElementById('socialSelectBtn');
      const socialMenu = document.getElementById('socialMenu');
      const socialFallback = { social: 'ÎšÎ¿Î¹Î½Ï‰Î½Î¹ÎºÏŒÏ‚', quiet: 'Î‰ÏƒÏ…Ï‡Î¿Ï‚' };
      const setSocial = (code) => {
        const label = (code ? (window.t ? window.t('booking.sociality_options.' + code) : (socialFallback[code] || 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ')) : 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ');
        const lblEl = socialBtn?.querySelector('.label');
        lblEl?.replaceChildren(document.createTextNode(label));
        lblEl?.removeAttribute('data-i18n');
        try { sessionStorage.setItem('gw_sociality', code); } catch(_){ }
      };
      const defaultSocial = (()=>{ try { return sessionStorage.getItem('gw_sociality') || ''; } catch(_){ return ''; } })();
      if (defaultSocial) setSocial(defaultSocial);
  socialBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); if (socialMenu) { socialMenu.hidden = !socialMenu.hidden; if (!socialMenu.hidden) { const row = socialMenu.closest('.s2-row'); if (row) { const rect = row.getBoundingClientRect(); const spaceBelow = window.innerHeight - rect.bottom; socialMenu.classList.toggle('dropup', spaceBelow < 220); } } try { applyTranslationsToStep2(); } catch(_){} } });
      socialMenu?.querySelectorAll('button')?.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const code = btn.getAttribute('data-code') || '';
          setSocial(code);
          if (socialMenu) socialMenu.hidden = true;
        });
      });
      document.addEventListener('click', (e)=>{
        if (socialMenu && !socialMenu.hidden && !socialMenu.contains(e.target) && e.target !== socialBtn) socialMenu.hidden = true;
      });

      // Persist all values on Next and go to Step 3
      document.getElementById('s2Next')?.addEventListener('click', (ev)=>{
        try { ev.preventDefault(); } catch(_){ }
        try {
          // adults
          sessionStorage.setItem('gw_adults', String(getN(adultsCount)));
          // children ages
          sessionStorage.setItem('gw_children_ages', JSON.stringify(ages));
          // dropoff same as pickup by default
          sessionStorage.setItem('gw_dropoff_same', 'true');
        } catch(_){}
        try {
          const origin = (window.location && window.location.origin) || (window.location.protocol + '//' + window.location.host) || '';
          const absUrl = origin ? (new URL('/step3.html', origin).href) : '/step3.html';
          try { window.location.assign(absUrl); }
          catch(_e1){ try { window.location.href = absUrl; } catch(_e2){ setTimeout(()=>{ window.location.href = '/step3.html'; }, 0); } }
        } catch(_){ window.location.href = '/step3.html'; }
      });
      // Re-apply selected labels when language changes
      try {
      window.addEventListener('i18n:changed', () => {
          // Preferred language is now auto-assigned from current locale (no dropdown)

          try {
            const curTrav = sessionStorage.getItem('gw_traveler_type') || '';
            if (curTrav) setTravType(curTrav);
          } catch(_){ }
          try {
            const curInterest = sessionStorage.getItem('gw_interest') || '';
            if (curInterest) setInterest(curInterest);
          } catch(_){ }
          try {
            const curSocial = sessionStorage.getItem('gw_sociality') || '';
            if (curSocial) setSocial(curSocial);
          } catch(_){ }
          try {
            const curAge = sessionStorage.getItem('gw_age_group') || '';
            if (curAge) setAgeGroup(curAge, (ageMap[curAge] || ''));
          } catch(_){ }
          // Ages hint may need re-translation
          try { renderAges(); } catch(_){ }
          // Re-render trip title/description if we have cached trip JSON
          try {
            const t = window.__loadedTrip || null;
            if (t) {
              const lang = (window.currentI18n && window.currentI18n.lang) || localStorage.getItem('gw_lang') || 'el';
              const getLocalized = (field) => {
                if (!field) return '';
                if (typeof field === 'string') return field;
                if (typeof field === 'object') return field[lang] || field['el'] || Object.values(field)[0] || '';
                return '';
              };
              const title = getLocalized(t.title);
              const desc = getLocalized(t.description);
              // Re-select DOM nodes here to avoid scope issues with earlier IIFEs
              const titleEl = document.getElementById('s2TripTitle');
              const descEl = document.getElementById('s2TripDesc');
              if (title && titleEl) titleEl.textContent = title;
              if (desc && descEl) descEl.textContent = desc;
            }
          } catch(_){ }
        });
      } catch(_){ }
      // Ensure translations are applied to step2 DOM nodes when i18n loads/changes
      try { window.addEventListener('i18n:changed', () => { try { applyTranslationsToStep2(); } catch(_){} }); } catch(_){ }
      // Also run once after DOM ready to catch initial language
      try { document.addEventListener('DOMContentLoaded', () => { try { applyTranslationsToStep2(); } catch(_){} }); } catch(_){ }
    })();
    // Ensure translations apply after DOM is fully ready (covers any early t() fallback rendering)
    document.addEventListener('DOMContentLoaded', function(){
      try { if (window.currentI18n && window.setLanguage) window.setLanguage(window.currentI18n.lang); } catch(_){ }
      try { setTimeout(() => { if (window.currentI18n && window.setLanguage) window.setLanguage(window.currentI18n.lang); }, 60); } catch(_){ }
    });
  </script>
  <script src="/pwa-install.js" defer></script>
</body>
</html>
