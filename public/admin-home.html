<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Home — Greekaway</title>
  <link rel="stylesheet" href="/css/admin-core.css">
  <link rel="stylesheet" href="/css/admin-home.css">
  <link rel="stylesheet" href="/css/admin-cleanup.css?v=20251030-1">
  <!-- Provide an inline favicon to avoid 404 /favicon.ico in headless checks -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E">
  <script>
    // Aggressive SW + cache cleanup to avoid stale admin-home on any device
    (function(){
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister())).catch(()=>{});
      }
      if (window.caches && caches.keys) {
        caches.keys().then(keys => Promise.all(keys.map(k => caches.delete(k)))).catch(()=>{});
      }
      try {
        // Also nuke our own storage in case we cached anything (we only keep session in-memory)
        sessionStorage.clear(); localStorage.removeItem('ah-cache');
      } catch(_) {}
    })();
  </script>
  <!-- Pin a version to force reloads across devices; server will also add dev cache-busting in non-production -->
  <script src="/js/admin-home.js?v=20251031-2" defer></script>
</head>
<body class="admin-home">
  <!-- Unified sticky top bar with main title -->
  <header id="adminTopBar" class="admin-topbar" aria-label="Admin top bar">
    <div class="title">Διαχείριση Greekaway</div>
  </header>
  <!-- Top login bar (one-time); used to auto-login admin.html iframes -->
  <div id="adminLoginBar" class="login-bar" aria-label="Admin login">
    <label> User <input id="ahUser" type="text" placeholder="admin" /></label>
    <label> Pass <input id="ahPass" type="password" /></label>
    <button id="ahLoginBtn" class="btn">Login</button>
    <span id="ahLoginStatus" class="hint"></span>
  </div>

  <!-- Navigation: top on desktop/tablet, bottom on mobile -->
  <nav id="adminNav" class="tabs" aria-label="Admin modules">
    <button class="tab active" data-tab="home" title="Home"><span class="label">Home</span></button>
    <button class="tab" data-tab="bookings" title="Bookings"><span class="label">Bookings</span></button>
    <button class="tab" data-tab="payments" title="Payments"><span class="label">Payments</span></button>
    <button class="tab" data-tab="partners" title="Partners"><span class="label">Partners</span></button>
    <button class="tab" data-tab="manual" title="Manual Payments"><span class="label">Manual Payments</span></button>
    <button class="tab" data-tab="availability" title="Availability"><span class="label">Availability</span></button>
    <button class="tab" data-tab="settings" title="Settings"><span class="label">Settings</span></button>
  </nav>

  <!-- Content area: iframes/sections are created lazily by JS -->
  <main id="adminContent" class="content" aria-live="polite">
    <section id="view-home" class="view active" data-tab="home" aria-label="Home">
      <div class="home-wrap">
        <h2>Διαχείριση — Home</h2>
        <div class="kpis">
          <div class="kpi"><div class="kpi-title">Σύνολο κρατήσεων</div><div class="kpi-value" id="kpiBookings">—</div></div>
          <div class="kpi"><div class="kpi-title">Σύνολο πληρωμών</div><div class="kpi-value" id="kpiPayments">—</div></div>
          <div class="kpi"><div class="kpi-title">Συνεργάτες</div><div class="kpi-value" id="kpiPartners">—</div></div>
        </div>
        <div class="admin-card admin-backup-card" style="margin-top:10px">
          <h3 style="margin: 0 0 6px 0">Αντίγραφα ασφαλείας</h3>
          <div class="admin-card-body">
            <div id="backup" style="line-height:1.4"></div>
            <div class="actions"><button id="refreshBackup" class="btn">Ανανέωση</button></div>
          </div>
        </div>
        <!-- Moved: Stripe Partner Tools (was in admin.html above bookings) -->
        <div class="admin-card admin-stripe-tools" style="margin-top:10px">
          <h3 style="margin: 0 0 6px 0">Stripe Partner Tools</h3>
          <div class="admin-card-body">
            <div class="admin-row">
              <label>Partner Email: <input id="partnerEmail" type="email" placeholder="partner@example.com" style="width:280px;padding:6px"></label>
              <button id="genStripeLink" class="btn">Generate Stripe Link</button>
              <span id="genStatus" class="hint" style="margin-left:8px;color:#ccc"></span>
            </div>
            <div id="onboardingResult" style="margin-top:10px; display:none">
              <div>
                <label>Onboarding URL:</label>
                <input id="onboardingUrl" type="text" readonly style="width:90%; padding:6px" />
                <button id="copyOnboarding" class="btn">Copy</button>
              </div>
              <div style="margin-top:6px;color:#ddd">
                Account ID: <span id="onboardingAccount" style="font-family:monospace"></span>
              </div>
              <div style="margin-top:6px;color:#aaa; font-size:12px">Note: Stripe onboarding links are single-use and time-limited. Use promptly.</div>
            </div>
            <div class="admin-row" style="margin-top:10px">
              <a href="/partner-manual-onboarding" class="btn" style="text-decoration:none">Δημιούργησε λογαριασμό Manual</a>
            </div>
          </div>
        </div>
        
      </div>
    </section>
    <!-- Other views (bookings, payments, partners, settings) will be injected on demand -->
  </main>
</body>
</html>
